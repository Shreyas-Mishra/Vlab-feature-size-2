<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/main.css">
</head>

<body>
    <div class="container-fluid main-wrapper">
        <!-- <div class="row lcontrol">
            <div class="col">
                <div class="panel">
                    <center>
                        <div class="btn-group btn-group-lg align-self-center scenes" role="group"
                            aria-label="Basic example">
                            <button type="button" data-scene="1" class="btn btn-primary active">SE Mode</button>
                            <button type="button" data-scene="2" class="btn btn-primary">BSE Mode</button>
                        </div>
                    </center>
                </div>
            </div>
        </div> -->
        <div class="row ucontrol">
            <div class="col-3">
                <div class="panel mb-1">
                    <div class="panel-head">
                        Instructions
                    </div>
                    <div id="typer">
                        1. Click on the load button and wait for the image to load. <br>
                        2. Set the values of Magnification, focus & contrast.<br>
                        3. Choose the type of line and click
                         2 points where the sixe is to be measured.<br>
                         4. Click on check size for the output.
                    </div>

                </div>
                <div class="panel padd">

                    <button type="button" id=load class="but sm w-100 blue" onclick="fon()">Load</button>
                    <div class="form-group mt-3">
                        <label for="formControlRange">Magnification</label>
                        <input type="range" min="1" max="6" value="1" class="slider" id="mag"
                            onchange="changeImage(this.value)">
                    </div>
                    <div class="form-group mt-3">
                        <label for="formControlRange">Focus<br></label>
                        <input type="range" min="0" max="10" value="5" class="slider" id="imgblur"
                            onchange="editImage(this.value)">
                    </div>
                    <div class="form-group mt-3">
                        <label for="formControlRange">Contrast</label>
                        <input type="range" min="0" max="10" value="5" class="slider" id="clight"
                            onchange="Contrast(this.value)">
                    </div>


                    <div class="row line-btn">
                        <button id=planeb class="but col-4 line" onclick="val1(1, this),drawl()" disabled>
                            <div id=plane>Plane</div>
                        </button>
                        <button id="dottedb" class="but col-4 line" onclick="val1(2, this),drawl()" disabled>
                            <div id=dotted>Dotted</div>
                        </button>
                        <button id=dashedb class="but col-4 line" onclick="val1(3, this),drawl()" disabled>
                            <div id=dashed>Dashed</div>
                        </button>
                    </div>
                    <!-- <br>
                    <button type="button" id=draw class="but sm w-100 blue" onclick=",drawl()">DRAW</button> -->
                    <br>
                    <br>
                    <button id="checksizeb" type="button" class="but sm w-100 blue" onclick="checksize()" disabled>Check Size</button>
                    <br>
                    <center>
                        <div style="border-radius:15px;border:1px solid black;width: 90px;height: 30px;background-color: rgba(5, 3, 0, 0.322);font-size: large;"
                            id="output">&nbsp;Size</div>

                    </center>
                    <button type="button" class="but sm w-100 blue" onclick="location.reload();">Restart</button>

                </div>
            </div>
            <div class="col-3">
                <div class="panel">
                    <img id="diagram" src="./images/sem.jpg" style="width: 100%;height: 590px;">
                </div>

            </div>
            <div class="col-6">
                <div class="panel  padd">
                    <img id="diagram2" src="./images/sample.jpg" style="height: 590px;">
                    <canvas style="transform:translateX(-50%);position:absolute;left:50%;" onclick="draw(event)"
                        id="myCanvas" width=50 height=50></canvas>
                </div>
            </div>
        </div>

    </div>

    <div id="toast-wrapper" aria-live="polite" aria-atomic="true" style="position:fixed;bottom:1rem;right:1rem;">

    </div>


    <script src="./js/jquery.min.js"></script>
    <script src="./js/popper.js"></script>
    <script src="./js/bootstrap.min.js"></script>
    <script src="./js/zoom.js"></script>
    <script>

        function preload(arrayOfImages) {
            $(arrayOfImages).each(function () {
                $('<img/>')[0].src = this;
            });
        }










        var tWrapper = $("#toast-wrapper"), ti = 0;
        function showToast(msg, type = 0) {
            tWrapper.append(`<div id="t${ti++}" class="toast${type == 1 ? ' danger' : (type == 2 ? ' success' : '')}" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    <svg class="bd-placeholder-img rounded mr-2" width="20" height="20" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img"><rect width="100%" height="100%" fill="${type == 1 ? '#ff0000' : (type == 2 ? '#31a66a' : '#007aff')}" /></svg>
                    <strong class="mr-auto">Notification</strong>
                    <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="toast-body">
                    ${msg}
            </div>
            </div>`);
            $(`#t${ti - 1}`).toast({
                delay: 5500
            });
            $(`#t${ti - 1}`).toast('show');
        }















        var type = 1;
        function val1(x, ele) {
            $(".line-btn button").removeClass("active");
            $(ele).addClass("active");
            console.log(ele,$(ele) );

            type = x;
            if (posprev == null || posnext == null)
                return;
            ctx.beginPath();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (type == 1) {
                ctx.setLineDash([0, 0]);

                ctx.lineWidth = 5;
                ctx.strokeStyle = "red";
            }
            if (type == 2) {
                ctx.setLineDash([2, 2]);
                ctx.lineWidth = 5;
                ctx.strokeStyle = "red";
            }
            if (type == 3) {
                ctx.setLineDash([10, 3]);
                ctx.lineWidth = 5;
                ctx.strokeStyle = "black";
            }
            ctx.moveTo(posprev.x, posprev.y);
            ctx.lineTo(posnext.x, posnext.y);
            ctx.stroke();

        }
        window.onresize = function () {
            canvas.width = $("#diagram2").width();
            canvas.height = $("#diagram2").height();
        }

        //add disabled class

        function hasClass(ele, cls) {
            return !!ele.className.match(new RegExp('(\\s|^)' + cls + '(\\s|$)'));
        }

        function addClass(ele, cls) {
            if (!hasClass(ele, cls)) ele.className += " " + cls;
        }

        function removeClass(ele, cls) {
            if (hasClass(ele, cls)) {
                var reg = new RegExp('(\\s|^)' + cls + '(\\s|$)');
                ele.className = ele.className.replace(reg, ' ');
            }
        }
        addClass(document.getElementById("mag"), "out");
        addClass(document.getElementById("imgblur"), "out");
        addClass(document.getElementById("clight"), "out");
        //put this outside the event loop..
        var canvas = document.getElementById("myCanvas");
        var ctx = canvas.getContext("2d");
        var temp = 0, flag = 0;
        var posprev, posnext;
        posprev = posnext = null;
        var dist;
        function getMousePos(canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            return {
                x: evt.clientX - rect.left,
                y: evt.clientY - rect.top
            };
        }
        temp = 1;
        function drawl() {
            temp = 2;
            document.getElementById("checksizeb").disabled = false;

        }
        function draw(evt) {
            if (temp == 1)
                return;
            else {
                flag++;
                if (flag == 1) {
                    posprev = getMousePos(canvas, evt);
                }
                else {
                    temp = 1;
                    posnext = getMousePos(canvas, evt);
                    flag = 0;
                    console.log(type);
                    if (type == 1) {
                        ctx.lineWidth = 5;
                        ctx.strokeStyle = "red";
                    }
                    if (type == 2) {
                        ctx.setLineDash([2, 2]);
                        ctx.strokeStyle = "red";

                        ctx.lineWidth = 5;
                    }
                    if (type == 3) {

                        ctx.setLineDash([10, 3]);
                        ctx.lineWidth = 5;
                    }
                    ctx.moveTo(posprev.x, posprev.y);
                    ctx.lineTo(posnext.x, posnext.y);
                    ctx.stroke();
                    // canvas.disabled = true;
                    addClass(canvas, "out1");
                    dist = Math.sqrt(Math.pow((-posprev.x + posnext.x), 2) + Math.pow((posprev.y - posnext.y), 2))
                }
                console.log(flag);
                console.log(dist);
            }
        }

        const typeSpeed = 30;
        var timerId, typeTarget = $("#typer");
        function type(txt, cur = 0) {
            if (cur == txt.length) {
                timerId = -1;
                return;
            }
            if (cur == 0) {
                typeTarget.html("");
                clearTimeout(timerId);
            }
            typeTarget.append(txt.charAt(cur));
            timerId = setTimeout(type, typeSpeed, txt, cur + 1);
        }

        // type("this is test")
        function fon() {
            document.getElementById("planeb").disabled = false;
            document.getElementById("dottedb").disabled = false;
            document.getElementById("dashedb").disabled = false;

            document.getElementById("diagram").src = "./images/sem.gif";
            document.getElementById("diagram2").onload = function () {
                canvas.width = $("#diagram2").width();
                canvas.height = $("#diagram2").height();
                console.log("setting");
            }
            setTimeout(() => {
                document.getElementById("diagram2").src = "./images/slide18.jpg";

            }, 8700);
            // document.getElementById("load").disabled = true;
            document.getElementById("mag").disabled = false;
            document.getElementById("imgblur").disabled = false;
            document.getElementById("clight").disabled = false;
        }
        function editImage() {
            var obj = document.getElementById("diagram2");
            obj.style["filter"] = "contrast(" + document.getElementById("clight").value + ") blur(" + document.getElementById("imgblur").value + "px)";
        }
        function Contrast() {
            var v = document.getElementById("diagram2");
            v.style["filter"] = "contrast(" + document.getElementById("clight").value + ") blur(" + document.getElementById("imgblur").value + "px)";

        }
        var val = 1;
        function changeImage(value) {

            val = value;
            if (value == 1) {
                document.getElementById("diagram2").src = "./images/slide18.jpg";
            }
            if (value == 2) {
                document.getElementById("diagram2").src = "./images/slide19.jpg";
            }
            if (value == 3) {
                document.getElementById("diagram2").src = "./images/slide20.jpg";
            }
            if (value == 4) {
                document.getElementById("diagram2").src = "./images/slide21.jpg";
            }
            if (value == 5) {
                document.getElementById("diagram2").src = "./images/slide22.jpg";
            }
            if (value == 6) {
                document.getElementById("diagram2").src = "./images/slide23.jpg";
            }

        }
        // console.log("typetjhis")
        function checksize() {

            console.log("typetjhis", val);

            if (val == 1) {
                var x = Math.round(100 / 30) * dist;
                x = Math.round(x,2);
                document.getElementById("output").innerHTML = x;
                console.log(x);
            }
            if (val == 2) {
                var x = (50 / 72) * dist;
                x = Math.round(x,2);
                document.getElementById("output").innerHTML = x;
                console.log(x);
            }
            if (val == 3) {
                var x = (10 / 28) * dist;
                x = Math.round(x,2);
                document.getElementById("output").innerHTML = x;
                console.log(x);

            }
            if (val == 4) {
                var x = (5 / 44) * dist;
                x = Math.round(x);
                document.getElementById("output").innerHTML = x;
                console.log(x);

            }
            if (val == 5) {
                var x = (5 / 74) * dist;
                x = Math.round(x);
                document.getElementById("output").innerHTML = x;
                console.log(x);

            }
            if (val == 6) {
                var x = (2 / 43) * dist;
                x = Math.round(x);

                document.getElementById("output").innerHTML = x;
                console.log(x);

            }


        }
        $(function () {
            preload(["./images/sem.gif"])
        });
        // if(val==2){
        //     var x=(50/72)*dist;

        //     documeny.getElementById("output").innerHTML=x;
        //     console.log(x);

        // }


    </script>
</body>

</html>